# Alone in the Dark engine
#   info and PAK_explode from "Free in the Dark" project: http://sourceforge.net/projects/fitd/
# script for QuickBMS http://quickbms.aluigi.org

# PAK_explode
set MEMORY_FILE3 string "eNrtWw10W8WVnifJsezIkUKUxAlOrBABMQlBMnJsWU5jxRYYiGggEWUB1/hHIi7+SeUnJ3RrmoesNpOJik+LT4GWLVmgZUO3y+5JQgKYSrFbx7SA87PFDQG8WUMUpBbRsPkxabT3zntynMQhh/ac9uw2c85oZu7ce+ebO/fe9zLPcd/TRdSEEA3UVIqQnUQu5eTSZQPUKfkvTyHbst6Yt1NY8ca81Wsa20xr/a0P+GubTfW1LS2toqnOa/IHWkyNLabKL68yNbc2eBfn5GSbFR0rXYSsELLJ9+MzV6T1DpMp8ycLKiOZC4NCqI8QEjFAi9WCHHvqeF8l4xY4/jRwgQ8WLSFEzQkmlENhpVWaJCH90KB0QkUuXiwC6RQ+Z94kkFzyxcti0bteRPE8BRDuVXMuz/1k5f2LG2rFWuhXqRCLwnPVuXzlxBJZ7JcZHxOUw0P+ay7gK1/sXVPjg9PRcOMrfAsm0FfX1oZ9jYRALnb+5ZHFXlxXsWVS0XfdBOs2cj7F1oK8j0UTrFtx52rsc5sagI/vewI+sYnjM/Efha9wIrt4m1rriXyGFoXPdgHfcvJ3Wjz0g2Ail7m0/ZVmreH+PXXQagi0VGOO5V9JyEBveAcyhl+99pL8H88G/uBJYVaktyu87RqFf1UwYWTTkSe0T7SxOSgVjGvsB9dNZ+pQRDyWGsRphdgep0Zz7F9BU38GEgmBnsaMTezHQA32Ge+t7qXHx+MpodWfsmodDZxkAS3tOM06DMHPBLGCftOspfeZNdRmjt2YC7IJXeidwKw0GH3nd0EDdY3E7kqlUsw1wkAN6Og4TRPVu3UkLF6DS2/ApRfB0qHIMygo1smJ4xncyJaRclAVEY24FtoC/QvWSw3CYrGvTgfRJ2YSkp4V5NnYczNlNJEAi/3uTCpljcQf6cL1rJGj7QAm1jcLY0pHCFIagNIlF9n+aBBYN/YmcN0Jq3tR97Ry+RSis1C3FshTkWwClMi/ck8dGDqnshDwDohWIBWgCqaouA55ixUVD4+pyAI+EAHRgV7+bIj/tEtuD5+HZTnI3AESV6Oi2xRFReMVKRjAo9qJrONIV9o/XLq4IbzyJLtHg8f/czgsOgTWSeBxD/QC11fuWiUldJPAKiHbaCqFKVPqMGAmadeDNNuAGYXyuXA3GmzXVG48+vaxF5hHx1wGlp3qDONMcLemKvDJLjwLFjDYtyMNvKLD1J9JkOYy4wFzy1+ZAfhf5VIkMMkZPDU1kKThKliEBcz2KW0qOuVlA0GebplHfWvgGOsw22e2q+jM13CJ/R/GDQu3cRX6jb8CkM69H9r3+hNsMxfZiQ5T8CbdvmgUGbYCg/AJlef6Q8PgGwiFdq+EaUvEOhCfot6cgZN0cwbOBiOaVBgnA0fC2++DdhdmQ3qChZB47AVrhAV0TPdtOPMZbFv4EIjQTs54E5WH5Q6XwX8Q4MAAlsRfHnQhU0rpuZ6XCZUgJRumP7Ra6Yd7UBftWQG/wTdTYd2jNJyHlG4LWqm7HH6PPqEGs8pm2xzm4MNIl0m3/IKb6QjtWTBGC6fZTCh+M4iHHxaY28wEFka9BXtpGNHYo+2TKMfFQlVIH6QhDbQ7UeWmMHb3DztCuFh7kzpkRmAAHdlRM+Mcskh8KeMze4dljiCnahhvGLhWCa7Hp9qvlFkXIk1R6HRwQP6XKdcpiwmDDu6R7TMc3di2TWFhmwL/Api4jzFIm3vMqRRY85daPH2dmXbnAjn23HSiIAlFGCcFrn9RHUrpO78OfsQ8z9PVZg3zaCGIaIhL/PA0gsHu0duRhQsHI1rFDG4TFdI0DXWZWBj7/U4NjwTOQyt7ng+lRD9DN0Nk6CGsswfdQ8ai38Gb6LBB+m/0iqxeeU/BqEm/Y8BHf83CXFG4LL3njXv3D1fND3GFexfyNffH2Irtz9O8KNuObFSMauggPRM3sh48vhPv0x4z9yucZY9tR/sIu+3dVQjg0Xf/BEQ+tYk70IIorBz9rzQgQIBOaQ+jm/on+V6pJ/Faxp2WLaM9XKXbaH+rzSxxt9b/IErf8klHUmSXCYa+glOwC5+8QHwe4xtZ6Dayjjz9jjK9T9bgo5+xjlwfM345GELNGtmXC6KKg8sbYD24643R/R9TeaOn2HZ+FHw2nkXz3qSr39QIpxSH+li2BwsvwGmtlZ/C3qMhOeiTOEb67Qs7uUn4WqD9yJfn84Ucr27H8wq8n+IhF+TGJPrQT4CYClXxhS1omh5uyO96wF/oKAuhLgg4KlgjwZ5FXKY7cqu+e7d+x755g/EMnrekPszI9361Jp2igwnItFq20sBKeH61j7bpWJVWv0M31bmcrjRY98VV9I9srcH6jv1M22R2N0zl3XgTXWug7wU/1N9EA8loXFMRtk1zBAzrFtDqBHXFWHUSMjzN61qecicCnzBX7JbAy9YIcACk6LAKwKC7Bvt05yCxsWotc+UyTagBn0au3zBPHjN284FnD3g+04X5wN0HKX+MLcJWaajnUL/rgMBzX4LwJonN0UygsQrYhkMN6FcBeqOqnFYYsjxJ4MRYjU8KdiSIePC4KwkJKxF2Qmy+C/S9zcmU+xCNxvPYKgOAnwbyFSCvMSynqwz7h7NcyWBU63Dn+t9nruSJwfmIVxfW7KZv6V+qUu1vThZAxxAcNbVXBkfr9Z01atjy4fz4XHabwXrcMRn0tYE+2xQnvc1AT+3/MCuQDPZr7W/732Pu5Im983V866xcE9bsib9AOxKvldzPx8wT2/gI9pdTT0waJRsI+MdBFe5Up64w7sKXbNp/7DmpwohzYBnZJDFukn9Hxo7k3o/jcxDJPkCiWCYbkYArHs56GxKOw2X2v0dHN7nN+z+inuRCl/nSxjD536fuhGKPPojQsCaatoY7oX/JEjxjar85eAbMsRJgBD/Mj5smArHJnQAUnmQQzsgeSPjfYZ7kiX3zjdvHLDIY/ym0PuoagkO7FKy88bD2MI8Bjmk8LH5Kt/BTwiigv/2LgD2nf6kcUvMwvD0XXxJc8FRm+/v6HeB8ruFoc1IbPKrlUIftrkPtGQWuQ/HMftchAmV+RwQOvmBU/5JrqGA39YzQ6iHJO5L6FiHMHbO7R9qzX8HjXlg9EtcqvZijerhdzaqHC6qH4X3Z7oqtyw92HCDiLFAl7UYfom/T31kjx7YK1TEBJO+AaF0InEPMMxI2zqaeQX8+kDK46wVGpF9xmX76u2PPggSgiOM0MG/ahDMbN+Jv+XKHZzDwe5gFHqkjhmACNzD3EHPq1E4j9+MxL2WuIal8AkcNdgyDW8/GtFY9FOw4BIM7IdfJPv6aDAM2fuxZ2IqwymiNQFoReFqxnZNWLDytGMenldzxaSVvXFqpgHM7m0li4zKJkleOPqj+nIQSSyeU2FhCiYXvgITSCXRwv70x6sKsIueACPiW4hJaHnl7ZafYrQ2OZra/y7e4yZUEF9ooYd8JjiGd4racL1vBB0acKNARKq4XjWkpKPxIC3lifNxfdPV+WNzhyYO4P7nJnbcf4S705NG9l0yCGGCxiwRY7IvEfUwJrxiEV+wScR+7FCzjeFiYns+BdfG4vzSwS8d97M+I+9jEcd/HPImLxH1i4rhPnB/3ibNxnzg/7hNK3CcujPvExHGfUOI+8Tlxn5A6El807hMXifsXLoz7BMZ94ty4t4yLeymxWYMxYNC/BOHuBuO+ytw66o70u/rkxfZgQ13b4ClF3TsBQyaMlzpz1GRWBN+3XYO0+9nPUqkNhzXh7dugE67eFu4Y1nd+m4sPZUGDlyoEPUc0a2ieOfbT48DmGqKV5rywawSaXOAwEpnToLQ6Ilwo+XoylUJaOTlL+weu7QBqo9+UVW2w7KnjqqCNL+l3jaDO8+XmoZznAF19oVxEbnUTid08DoK8Y5yBXePkG/+TSh0PoT1UYc9g2HVIdHD9lefqL7deXP+Rj+EfE2jkuH0i0cjniP4MRScRTGAjITwIFhhk7gPMc4h2PwaYmGdYPizxS2gtEMulK8xGxo/CwELIQ0E3rKsFk3CdIdgRw0OSh/NhifgCCoBA2gDSOsZVowjjG09zPnMKBQ/hUDHOkT8gZTjNMARDa0TqQw/kLgn3QEQpHmuEfoD3Yefdz+HV0nxInKiDL+nS4n1MTwYh3LsHlPut4Em1ODRG8XWN3deNkIE6UBMsVbdbg0vXD++pU4nZ/Rm8QwjIqfSdGQJ2BH3nPxFFLas+jXr6M0aAT5Cv7p7H2yFbJrAmNHCFVgUz+s5RnANs25WLIh2f1z5zAGaRPgj0LcjK7xXhqJ7pG1Yo/D5J37kTl8sBfrzOWsam4zykyiIZo3AuIozcsfu3yjFz/BwserQCb1oyUBwmAfoBpYcMoUkcdn9GFRLTOuUlyFntrxgNA3XSZ/ALWzuG/zzGi00VXAL2amRy4Pfj0Uy0XPzJs/d7tPokmzMMJ0ADp8MBHbrvTMVgPDX1lsO1pq4fAKJtn4ZDxQ2JZi24C554rBtIscczFH+oCg3ADSnthQtS+lsK15tvBXLG33X2hl17cA38FpF2uu9nKDeUYjs4Z/CkRiwIniwXzXIe0jHXAR5UigRz7UFz+biQAW8706GGN2iKgs2o4DtpBbzRgp5x8tfI8kdr8GrhPvnKNE+5AHbCTt8D0yoXy+fc/265G4wIW4QNwvYA87nb2/kYCF+PP8GTmf0ZyIxmfPhg8OTkV5D88AK2FNtQKjCXFT2OveMBI8v5EfYGAtmvPA0dfj/LpoX2Be6DFzuILw88h9H9QzkCnolO+gx1tHW+hh+ogIVN1u9YpRWSwifBUQOzi/XweqDvfBIPcFQrBpRsizc2sL81uL8zcIsha9EHS8EGXBM8JEDZLv6lK8kM6mnBXi2FBDUayz+TZve/ezQb+H1d8BLiC+1b31rwerislHaM7FKhrTwjsWOgOl7Upd9h6Ny33jk2LSjTB3B6hq9LXQKjgrf4ajAfexXoY1vTP3INLHL0aVz2dQLdgteFUXx274QhOTvcRCv5nmy4p+tAQ5dSFP/WbikvBAsROKiZqUE+CK/UMHjbmY59MO3R9GcH4MeXbgObo1sEx/dZSrw+9I44LWx7Cse+rtSM4B80wbgQOA7rrV0A691zBBD3Ge79ajXeM1vfiatob7hCYMYQSsDpJeM9MDHef7QsZ42cR1QDvf0Z2OcZMS51eXjYQoqFqEX8aTxbNgxzoJlh70lcClbvAkpsM74Vz3mRpykNIF3I1OjYHiADgf4qtgp6IKcLHRe1cKz8UwG7VwvfJf4zrWOlzKxonsDfMb+D44nL/VMhfwcyYj68SOaQe2P3QJ+jA47AR/0Z2EXJtPaDAtcef4v7M+fEcwDG8WkT7T9e6meK1FA8p2t8UZ4XXA2r1sLOcqwRyHLny4sgv0UxCy7HDPaDAW28Elsxn0ZZOcp+kmZ3y8spqthKLb2DJ+zucSoLFEgHcXo66o4fOgcPKMzg8phGdLIk7i32KB5p784UFDiiQ5A7FZ1UjRdNFZrYL4kCl87hvxVaWCm98Iv8ChyX3tKVunoI0nQXtJ8qbVJpTyvtIaU9qbQaQW5jypgo44Qy3qa0O5W2T2l/prSDSvsbpd2jtC8q7bNK+6rSPq+0Ed7K/hPb/kEqBdspuwLtOJJK8XcKtEdyoewt2CeXy//7oiYakkEmkUyiJVkkm0wmOpJDphA9MZCp5AoyjRjJdDKDzCS5ZBaZTa4keWQOmUvyiYnMI1eR+cRMribXkGvJAlJAriMLySJyPVlMbiAWYiWF5EZiI0VkCSkmJcROSomDlJGl5EtkGSknTvIXf3bXqv7GOxCIRARBEgSVpBLUklrQSBohQ8oQJkmThEwpU9BKWiFLyhKypWxhsjRZ0Ek6IUfKEaZIUwS9pBcMkkGYKk0VrpCuEKZJ0wSjZBSmS9OFGdIMYaY0U8iVcoVZ0ixhtjRbuFK6UsiT8oQ50hxhrjRXyJfyBcAgkShgcAKKKOBwApIoYHECmijgcQKiKGByAqoo4HICsihgcwK6KOBzAsIoYHQCyijgdALSKGB1Atoo4HUC4ihgdgLqKOB2AvIoYHcC+qg+D56p5HL5P1uaGuseqK+vaatpWFd4vXVxQ1MTqanxex9obBO9fv6XQt6axhZfq8z4teutCs+t7TV3KlwVTbVtbd42kGvwTiTJiwBVDTUTqh5qPtRlUL8FNYVVgKqGmglVDzUf6jKowIBPoubGlgfWNVstCkI+FNf4AWpza7u35kHvQzUNYqt//NQYzWDeU+dGKv4hmtjY7DX5ahubAn5vaTYxme5q9IuB2qY7Al7/Q3zC22DytfpNVzeY6h4SvW2mWtFU29Dg97a1ma5eC1BBxtPyYEvruhbT2jZvoKHVxP/GqFZsbAWKv1VsrW9tMrV7/W1AADWLsy8hU9comtoav+GVeS+Xy+WvW9J/e9mQlON0klIXwLgc6t1Qr5pHyP5cQq6bQ8gt0P7kCkI2QG2FuX+EyqA+BXUr1F1QUVP62RxoWVtb/yCP3JXO22q869c2tTZ4x/drmhrFc8YtrWnKA16xRvR7ZfY1AZ9YUxdobGo4O/Th5OXyZ5YyIoz1n1YJ5FkYrx1HGwbaEIwnKjpBIGaoZVBvhXoP1BaoG6D+COo2qH1Q90EdgYrlU2hVoFMH1QjVBHUB1EKoZVArod4O9W6odVD/mus8SCq9TV7RW+FvFBvra5tWeesxP5OHiasFnmnnk8lvyU3geysa6/y1/oeIS7jZK66obRNdfj88dMgdOHa3NgSavFW1LQ1NXichTUhb6W+td8oPFEISwi0toLa2CfL/+QtMVq3w1rZfQIY9rWitbVDWBa1/Uq1uagPFd9U2Bbxkrlp5osE6IogQMk89/hlHiA2ekhCMrS3e9RBkO0iN1+9vaSUkW6hpbK0jZLaqZl1jS3Pt12AbN6tq61r9IlmlAgT4l7RgLZ+vKdC2hpCvq+TYe0jlWwcYofesqlnh2qpq9jbXr4XVEqp231p/Y4voI7wIX6je5rrzdteKGwt59oBiJMIXqs1t7fV+kUtfLhMX/n40OP/ye/zfY5llGqjLg1oCF1saw8BlH/i7C35CGqDJsUy3LLW4LI2WNstGy1OW45YbrGVWp3WX9dfWw9aj1k+sp61TCs2FrsKvFDYXflDyx5JUic7+e/uf7FmlqdLHHe6y9WVS2Q/LtpT9sky7tGzpLUvvWhpfemLpiS91LcMv9Pgp3mVZa3nI8n3LE5YeC7GmrJmFxYXLCn9Q+OPCfYUHC2fZrrVZbHfb6m1+2wZbl+1x21O2rbZ/s0Vsr9sO2LKKphUtKCouurnIXdRQtL7okaIfFv2i6F+W9C/5cEl8yadLVMXZxcbiucXXFt9e7CmmxY8V/7i4t7igpLpkXUlnSVfJ1pKXS94oSZRo7Ua73X6b/S77o/a37YdhB0Lp5NL5pVWl9aXNpd8r3VE6UDpUmu3Ic1zluMGx3HGr407HPY46x9ccfsc3HI84Njm+53jS8c+OrY7/cLzs2O143bHPcdBx2PGR44zDUCb/XxUdNOWF+CP3RyxoZ4H3NRathZgEMDvy4khnIX/D8r8W9zkp"
get SIZE asize MEMORY_FILE3
comtype base64
clog MEMORY_FILE4 0 SIZE 5680 MEMORY_FILE3
comtype zlib
clog MEMORY_FILE3 0 5679 13824 MEMORY_FILE4

get BASENAME basename
get DUMMY long
get FILES long
math FILES -= 4
math FILES /= 4
goto 4

for i = 0 < FILES
    get OFFSET long

    savepos TMP
    goto OFFSET
    get additionalDescriptorSize long
    get discSize long
    get uncompressedSize long
    get compressionFlag char
    get info5 char
    get offset2 short
    savepos OFFSET
    math OFFSET += offset2
    goto TMP

    set NAME string BASENAME
    string NAME += /
    string NAME += i
    string NAME += ".dat"

    if compressionFlag == 0
        log NAME OFFSET uncompressedSize
    elif compressionFlag == 1
        log MEMORY_FILE OFFSET discSize
        putvarchr MEMORY_FILE2 uncompressedSize 0
        goto 0 MEMORY_FILE2
        calldll MEMORY_FILE3 PAK_explode cdecl RET MEMORY_FILE MEMORY_FILE2 discSize uncompressedSize info5
        log NAME 0 uncompressedSize MEMORY_FILE2
    elif compressionFlag == 4
        comtype deflate
        clog NAME OFFSET discSize uncompressedSize
    else
        print "Error: wrong compression flag %compressionFlag%"
        cleanexit
    endif
next i
